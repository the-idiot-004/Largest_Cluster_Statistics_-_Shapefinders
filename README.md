# Morphological Analysis of the IGM During the Cosmic Dawn and the Epoch of Reionization

This project contains the code and data to reproduce the analysis and figures from the report "Morphological Analysis of the IGM During the Cosmic Dawn and the Epoch of Reionization Using Large Cluster Statistics."

## Project Structure

The repository is organized as follows:

-   `main.py`: The main script to run the entire analysis pipeline.
-   `run_all.sh`: A convenience shell script to execute `main.py`.
-   `src/`: Contains the core Python source code.
    -   `config.py`: Central configuration for file paths, simulation parameters, and analysis settings.
    -   `data_processing.py`: Scripts for pre-processing raw data, such as generating control files and subbox CSVs.
    -   `analysis.py`: Core analysis functions for shapefinders, percolation, and statistical calculations.
    -   `plotting.py`: Functions to generate all plots for the report.
    -   `utils.py`: Utility functions used across the analysis.
-   `data/`: Contains the data used in the analysis.
    -   `raw/`: Raw simulation output from `SURFGEN2`. This data is not tracked by Git.
    -   `processed/`: Processed CSV files used as direct inputs for the analysis scripts.
-   `results/`: Directory for storing output data and plots.
    -   `data/`: Output data files generated during the analysis.
    -   `plots/`: All output figures generated by the plotting scripts.
-   `docs/`: Contains the project report (`LCS_Report.pdf`).


## Simulation and Data Details

### Analysis Methods
The analysis is performed using two methods:
1.  **Entire Box Analysis:** Uses the full simulation box. Files ending with `_subbox0` are from this analysis.
2.  **Sub-box Analysis:** Divides the box into 8 equal and separated cubes. Results from this method are primarily used for error estimation.

### Cosmic Dawn (CD) Analysis
-   **Temperature Thresholds (TGamma):** Uses `TGamma = fT * 2.725 * (1 + z)` in Kelvin, with `fT` values of 1, 3, 6, and 10.
-   **Regions:**
    -   **Emission/Heated Regions (Overdensity):** Gas temperature above `TGamma`. Data is processed from `output_CD_overdensity_SURFGEN/`.
    -   **Cold/Absorption Regions (Underdensity):** Data is processed from `output_CD_underdensity_SURFGEN/`.

### Epoch of Reionization (EoR) Analysis
-   **Threshold Value:** Uses a threshold of 0.5 for ionized regions.
-   **Regions:** Analysis is performed for ionized regions only, from `output_EOR_overdensity_SURFGEN/`.

### Raw Data File Formats (SURFGEN Outputs)

#### `Cluster_stat_copy.z*` files:
These files contain cluster statistics. The redshift information is part of the filename (the float following `Cluster_stat_copy.z`).

**Quantities in the file (columns):**
-   `rho_th`: Threshold chosen for the analysis (Float).
-   `NC`: Total number of clusters (Integer).
-   `Total_count`: Total volume of the clusters in grid units (Integer).
-   `NIJK`: Total number of grid points considered (`grid**3`) (Integer).
-   `FF`: Filling Fraction (Float).
-   `percolation_no`: Number of different percolated clusters (Integer).
-   `count_max`: Number of grid points in the largest region (Integer).
-   `LCS`: Largest Cluster Statistics (Float). Calculated as `count_max / Total_count`.
-   `NN_max`: (Unknown, Integer).
-   `count_max_vol`: (Unknown, Float).
-   `vol_max`: (Unknown, Float).
-   `NN_max_vol`: (Unknown, Integer).
-   `vol_max_count`: Equal to `count_max` (Integer).

#### `Shapefinders_copy*` files:
These files contain shapefinder information. Redshift information is in the filename.

**Quantities in this file (columns):**
-   `NN`, `Ncount`: (Indices/Counts).
-   `arr12`: An array-like structure containing various shapefinder components.
    -   `arr12[0]`: Volume in grid units.
    -   `arr12[1]`: Area in grid units.
    -   `arr12[2]`: Isotropic Mean Curvature (IMC).
    -   `arr12[3]`: Genus.

**Method to estimate L, T, B, P, F (Physical Units):**
The original raw shapefinder values (`arr12[8]`, `arr12[9]`, `arr12[10]`) are used to derive Length (L), Thickness (T), Breadth (B), Planarity (P), and Filamentarity (F) in physical units, as follows:

1.  Take absolute values of original raw shapefinders:
    `raw_sf1 = abs(arr12[8])`
    `raw_sf2 = abs(arr12[9])`
    `raw_sf3 = abs(arr12[10])`
2.  Sort them to find T, B, L:
    `shapefinders = sorted([raw_sf1, raw_sf2, raw_sf3])`
    `T_grid, B_grid, L_grid = shapefinders[0], shapefinders[1], shapefinders[2]`
3.  Calculate Planarity (P) and Filamentarity (F):
    `P = (B_grid - T_grid) / (B_grid + T_grid)` (with small epsilon for division by zero)
    `F = (L_grid - B_grid) / (L_grid + B_grid)` (with small epsilon for division by zero)
4.  These are then converted to physical units using `config.CELL_SIZE_MPC_H`.

## How to Run the Analysis

### Prerequisites

-   Python 3.x
-   Required Python packages:
    -   pandas
    -   numpy
    -   matplotlib

You can install the dependencies using pip:
`pip install pandas numpy matplotlib`

### Execution

To run the entire analysis pipeline and generate all figures from the report, execute the `run_all.sh` script from the project root directory:

```bash
bash run_all.sh
```

Alternatively, you can directly run the main Python script:

```bash
python3 main.py
```

The script will:
1.  Process the raw data to create necessary control files.
2.  Run all statistical analyses.
3.  Generate all plots and save them in the `results/plots/` directory.

The final output figures are those referenced in `docs/LCS_Report.pdf`.